name: OAST Blackout Watcher

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  check_hits:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Verify Session Path
        run: |
          echo "Current Directory: $(pwd)"
          echo "Listing all files in root:"
          ls -F
          if [ -f "session.yaml" ]; then
            echo "✅ session.yaml found in root!"
          else
            echo "❌ session.yaml NOT FOUND. Checking subdirectories..."
            find . -name "session.yaml"
            exit 1
          fi

      - name: Poll Interactions
        run: |
          # Use the absolute path to ensure the client finds the file
          timeout 60s interactsh-client -session-file $GITHUB_WORKSPACE/session.yaml -v || true
