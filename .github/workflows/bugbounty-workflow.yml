name: Bug Bounty Workflow

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.22'

      - name: Install Nuclei
        run: |
          # Download the latest release of Nuclei
          NUCLEI_URL=$(curl -s https://api.github.com/repos/projectdiscovery/nuclei/releases/latest \
            | grep "browser_download_url.*linux_amd64.zip" \
            | cut -d : -f 2,3 \
            | tr -d \")

          # Check if the URL is not empty
          if [[ -z "$NUCLEI_URL" ]]; then
            echo "Failed to get the download URL for Nuclei."
            exit 1
          fi

          # Download the zip file
          wget "$NUCLEI_URL" -O nuclei-linux_amd64.zip || { echo "Download failed"; exit 1; }
          
          # Unzip and move to local bin
          unzip nuclei-linux_amd64.zip || { echo "Unzip failed"; exit 1; }
          sudo mv nuclei /usr/local/bin/ || { echo "Move failed"; exit 1; }
          
          # Verify installation
          nuclei -version || { echo "Nuclei installation failed"; exit 1; }

      - name: Download Nuclei Templates
        run: |
          nuclei -update-templates || { echo "Template update failed"; exit 1; }

      - name: Run Nuclei scan
        run: |
          if [[ -f "livelinkdomains.txt" ]]; then
            nuclei -l livelinkdomains.txt -t cves/ -o nuclei-results.txt || { echo "Nuclei scan failed"; exit 1; }
          else
            echo "Subdomains file not found!"
            exit 1
          fi

      - name: Upload Nuclei scan results
        uses: actions/upload-artifact@v3
        with:
          name: nuclei-scan-results
          path: nuclei-results.txt
